# 議事録パーサー詳細ガイド

## 概要

議事録テキストからタスクを抽出し、4層構造に分類するロジック。

## パース戦略

### Step 1: プリプロセス

```
入力テキストの正規化:
1. 空行の統一
2. 箇条書き記号の統一（-, *, ・ → -）
3. 日付フォーマットの検出
```

### Step 2: キーワードベース抽出

#### タスク候補の検出パターン

```
動詞パターン（Task/Feature候補）:
- 「〜する」「〜したい」「〜が必要」
- 「〜を実装」「〜を追加」「〜を修正」
- 「〜を確認」「〜を検討」「〜を調査」

バグ候補パターン:
- 「〜が遅い」「〜が動かない」「〜が壊れている」
- 「〜のバグ」「〜のエラー」「〜の不具合」
- 「〜できない」「〜が表示されない」

マイルストーン候補パターン:
- 「〜月末」「〜日まで」「〜にリリース」
- 日付言及（YYYY/MM/DD、MM/DD、〜月〜日）
```

### Step 3: 4層分類ロジック

```
分類フロー:

1. 日付が明示されている
   AND 複数のFeatureを包含
   → Epic

2. 複数のStoryで構成される
   OR 「機能」「〜搭載」「〜対応」を含む
   → Feature

3. ユーザー視点の価値を表現
   OR 「〜できるようになる」「〜が可能になる」
   → Story

4. 具体的な実装作業
   AND 3時間以内で完了可能
   → Task

5. 不具合修正
   → Bug
```

### Step 4: 粒度チェック

```
3時間ルール適用:

IF Task見積もり > 3時間 THEN
  分割提案を生成:
  - 「DBスキーマ設計（8h）」
    → 「テーブル設計（3h）」+「リレーション定義（2h）」+「マイグレーション作成（3h）」
```

### Step 5: 親子関係構築

```
関係構築ルール:

1. 同じ文脈で言及されたタスクをグループ化
2. 動詞の抽象度で階層を推定:
   - 「〜機能を実装」→ Feature
   - 「〜ができるようになる」→ Story
   - 「〜を作成」「〜を修正」→ Task

3. 明示的な親子関係キーワード:
   - 「〜のために」「〜の一部として」
   - 「まず〜、次に〜」
```

## 出力フォーマット

```markdown
## 提案されたタスク構造

🏁 Epic: [マイルストーン名]（[日付]）

### 🎯 Feature: [機能名]
#### 📋 Story: [ユーザーストーリー]
- [ ] ⚙️ Task: [タスク名]（[見積もり]h）→ @[アサイン候補]
- [ ] ⚙️ Task: [タスク名]（[見積もり]h）
- [ ] 🐛 Bug: [バグ名]（[見積もり]h）

---

📊 サマリー:
- Epic: X件
- Feature: Y件
- Story: Z件
- Task: W件
- Bug: V件

作成しますか？ [Yes / 編集 / キャンセル]
```

## アサイン推定ロジック

```
推定基準（Phase 2で実装）:

1. 過去のアサイン履歴
   - 類似タスクの担当者を参照

2. コミット履歴分析
   - 関連ファイルの変更履歴から推定

3. スキルセットマッチング
   - 「DB」→ バックエンド担当
   - 「UI」「CSS」→ フロントエンド担当

4. ワークロード考慮
   - 現在のアサイン数を参照
```

## エッジケース処理

### 曖昧な入力

```
入力: 「DBまわりをなんとかする」

処理:
1. 曖昧フラグを立てる
2. 追加質問を提案:
   「DBに関して、具体的に何をしたいですか？」
   - パフォーマンス改善
   - スキーマ変更
   - バグ修正
   - その他
```

### 日付なしの入力

```
入力: 「認証機能を追加したい」

処理:
1. Epicなしで構造化
2. 日付確認を提案:
   「いつまでに完了したいですか？（任意）」
```

### 大量タスクの入力

```
入力: 50件以上のタスク候補

処理:
1. バッチ処理（20件/回）
2. 進捗表示
3. 中断可能なフロー
```

## サンプル入出力

### 入力例

```markdown
## 12/17 定例MTG

- チャット機能が遅いのでDB周りを最適化する
- Mastraのキャッシュ入れたい
- RAGの精度が低いのでデータ見直し
  - Webからデータ集める
  - クライアントからデータもらう
- 1月末にプレビュー版出す
- 1/25にクライアント先でMTGあり
```

### 出力例

```markdown
## 提案されたタスク構造

🏁 Epic: v0.1-preview正式リリース（1月末）

### 🎯 Feature: チャット機能パフォーマンス改善
#### 📋 Story: レスポンスが3秒以内になる
- [ ] ⚙️ Task: DB最適化（3h）
- [ ] ⚙️ Task: Mastraキャッシュ導入（3h）

### 🎯 Feature: RAG精度向上
#### 📋 Story: 学習データが揃う
- [ ] ⚙️ Task: Webデータ収集（3h）
- [ ] ⚙️ Task: クライアントデータ収集（3h）
- [ ] 📝 Task: クライアントデータ受領MTG

#### 📋 Story: 検索結果の関連度が向上する
- [ ] ⚙️ Task: データ設計見直し（3h）

### 🎯 Feature: クライアントプレビュー準備
#### 📋 Story: プレビューデモが実施できる
- [ ] 📅 Task: 1/25 クライアント先MTG

---

📊 サマリー:
- Epic: 1件
- Feature: 3件
- Story: 4件
- Task: 7件

作成しますか？ [Yes / 編集 / キャンセル]
```
