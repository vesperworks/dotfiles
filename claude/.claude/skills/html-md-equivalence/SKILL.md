---
name: html-md-equivalence
description: HTML→Markdown変換の品質評価（RAG/QA用途）。html_sourceとmd_targetの情報等価性を採点する。情報保持率・構造等価性・参照保持の3軸で評価し、RAG/QAの誤答につながる要因のみを減点対象とする。
triggers:
  - HTML Markdown 変換評価
  - RAG QA equivalence check
  - md変換品質チェック
---

# HTML-Markdown Equivalence Evaluation Skill

HTML原文とMarkdown変換後が、RAG/QA用途において同等の情報価値を保持しているかを採点するスキル。

## 入力

| パラメータ | 説明 |
|-----------|------|
| `html_source` | HTML原文 |
| `md_target` | Markdown変換後 |
| `ref_md` | 参照用Markdownドキュメント（内部リンク解決用） |

## 評価基準（100点満点）

### 1. 情報保持率（35点）

テキストコンテンツの欠落・改変をチェック。

| 減点対象 | 減点幅 |
|----------|--------|
| テキストの欠落 | -5〜-15 |
| 意味の曖昧化 | -3〜-10 |
| 数値・固有名詞の誤変換 | -5〜-15 |

**評価しない項目**:
- HTMLエンティティの展開（`&amp;` → `&`）
- 空白・改行の正規化

### 2. 構造等価性（40点）

情報のアクセシビリティを維持しているかをチェック。

| 減点対象 | 減点幅 |
|----------|--------|
| 見出し階層の崩壊 | -5〜-15 |
| リスト構造の崩壊 | -5〜-10 |
| テーブル構造の崩壊 | -10〜-20 |
| コードブロックの崩壊 | -5〜-15 |

**評価しない項目**:
- 見出しレベルの一律シフト（H2→H1など、階層関係が維持されていれば可）
- リストマーカーの種類（`-` vs `*` vs `1.`）

### 3. 参照保持（25点）

リンク・参照の有効性をチェック。

| 減点対象 | 減点幅 |
|----------|--------|
| 内部リンクの欠落 | -5〜-10 |
| 外部リンクの欠落 | -3〜-8 |
| アンカーID の欠落 | -3〜-5 |
| 画像参照の欠落 | -3〜-8 |

**評価しない項目**:
- リンクテキストの軽微な変更
- 相対パス↔絶対パスの変換

## 評価ルール

1. **見た目・装飾の違いは評価しない**
   - フォント、色、余白などのスタイル情報
   - HTMLタグの属性（class, style等）

2. **RAG/QA誤答につながる要因のみ減点**
   - 情報の欠落
   - 構造の崩壊による検索性低下
   - リンク切れによる参照不能

3. **減点の原点を1つに集約**
   - 最も影響が大きい破損を特定
   - 派生的な問題は別カウントしない

## 出力フォーマット

**厳守**: 以下の3行のみを出力する。それ以外の説明・コメントは一切出力しない。

```
ref: <ref_md内でもっとも関連する内部リンク（例: ref_md#section-id）>
score: <0〜100の整数>
delta: <減点の原点を1行で記述（何が・どこで・どう壊れたか）>
```

### 出力例

**完璧な変換の場合**:
```
ref: ref_md#overview
score: 100
delta: なし
```

**テーブル構造が崩壊した場合**:
```
ref: ref_md#api-reference
score: 62
delta: 3列テーブルが箇条書きに平坦化、列間の関係性（パラメータ-型-説明）が消失
```

**内部リンクが欠落した場合**:
```
ref: ref_md#installation
score: 85
delta: 「詳細はAPIリファレンスを参照」のリンクがプレーンテキスト化、参照先不明に
```

## 評価フロー

```
1. html_source を解析
   ├── テキストノード抽出
   ├── 構造要素特定（h1-h6, ul/ol, table, pre/code）
   └── リンク・参照抽出

2. md_target を解析
   ├── 同様の要素抽出
   └── html_source との対応付け

3. 差分検出
   ├── 情報保持率: テキスト欠落・改変
   ├── 構造等価性: 要素の崩壊・消失
   └── 参照保持: リンク・アンカーの有効性

4. 減点の原点特定
   └── 最も影響が大きい問題を1つ選定

5. ref_md との関連付け
   └── 破損箇所に最も近いセクションIDを特定

6. 出力生成（3行のみ）
```

## 使用例

### 入力

```
html_source: <h2 id="api">API Reference</h2><table>...</table>
md_target: ## API Reference\n\n- param1: string\n- param2: number
ref_md: docs/api.md
```

### 出力

```
ref: docs/api.md#api
score: 60
delta: テーブル→箇条書き変換で型情報とパラメータの対応関係が消失
```
