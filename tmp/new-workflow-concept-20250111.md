# 新しいワークフロー概念：役割進化型アプローチ

## 📋 コンセプト要約

worktree機能を除去し、ccmanagerによる役割分担も不要にした、よりシンプルで直感的なワークフローを提案します。単一のClaudeセッションが役割を段階的に進化させていくアプローチです。

## 🔄 役割の進化フロー

```
Explorer（探索者）
    ↓ 理解を深める
Analyst（分析者）
    ↓ 戦略を立てる
Designer（設計者）
    ↓ 実装する
Developer（開発者）
    ↓ 品質を高める
Reviewer（レビュアー）
```

## 🎯 新しいアーキテクチャ

### 1. シングルセッション・マルチロール

```bash
# ユーザーフロー
$ ccm                        # ccmanagerでプロジェクト管理
$ /multi-feature "認証機能"   # 単一セッションで役割が進化

# 内部フロー
1. Explorerとして調査開始
2. 調査結果を基にAnalystモードへ移行
3. 分析を基にDesignerモードへ
4. 設計を基にDeveloperモードへ
5. 実装後Reviewerモードで品質確認
```

### 2. 状態管理の簡素化

**従来（worktree版）:**
- 複数のworktree作成・管理
- 環境ファイルでの状態保持
- 複雑なgit操作

**新アプローチ:**
- 現在のブランチで直接作業
- メモリ内での役割状態管理
- シンプルなコミット戦略

### 3. ccmanagerの新しい役割

**従来:**
- worktree切り替え
- 複数プリセット管理
- セッション分離

**新アプローチ:**
- プロジェクトコンテキスト保持
- 進捗の可視化
- ブランチ管理のサポート（worktreeなし）

## 💡 実装イメージ

### multi-feature.md（新版）

```markdown
# Multi-Feature Development (役割進化型)

## 使用方法
`/multi-feature "機能説明"`

## 実行フロー

### Step 1: Explorer Mode 🔍
- 既存コードの調査
- 要件の明確化
- 制約事項の特定
→ explore-report.md 生成

### Step 2: Analyst Mode 📊
- 影響範囲分析
- リスク評価
- 実装戦略検討
→ analysis-report.md 生成

### Step 3: Designer Mode 🎨
- アーキテクチャ設計
- インターフェース定義
- テスト戦略策定
→ design-doc.md 生成

### Step 4: Developer Mode 💻
- 実装
- ユニットテスト作成
- 段階的コミット
→ implementation-log.md 生成

### Step 5: Reviewer Mode ✅
- コードレビュー
- テスト実行
- ドキュメント整備
→ review-report.md 生成
```

## 🚀 メリット

1. **シンプルさ**
   - worktree管理不要
   - 単一セッションで完結
   - 学習コスト低減

2. **柔軟性**
   - 役割間の行き来が容易
   - 部分的な再実行が可能
   - 中断・再開が簡単

3. **可視性**
   - 進捗が明確
   - 各段階の成果物が明示的
   - ccmanagerでの統合表示

4. **効率性**
   - git操作の削減
   - ファイルシステムのオーバーヘッド削減
   - コンテキスト切り替えなし

## 📊 比較表

| 要素 | 現在（worktree版） | 新提案（役割進化版） |
|------|-------------------|-------------------|
| セッション数 | 複数（フェーズごと） | 単一 |
| git操作 | 複雑（worktree管理） | シンプル（通常のブランチ） |
| 状態管理 | 環境ファイル | メモリ内 |
| ccm連携 | プリセット切替必須 | オプション（進捗表示のみ） |
| 学習曲線 | 急 | 緩やか |
| 柔軟性 | 低（順次実行） | 高（役割の行き来可能） |

## 🔧 技術的な変更点

1. **worktree-utils.sh の簡素化**
   - worktree関連関数の削除
   - 役割管理関数の追加
   - 状態管理のインメモリ化

2. **コマンドファイルの書き換え**
   - Step実行から役割ベースへ
   - 環境ファイル依存の除去
   - プログレッシブエンハンスメント

3. **新しい共通関数**
   ```bash
   # 役割の切り替え
   switch_role() {
     local new_role="$1"
     echo "🎭 Switching to $new_role mode..."
   }
   
   # 成果物の保存
   save_artifact() {
     local role="$1"
     local content="$2"
     local filename="${role,,}-report.md"
     echo "$content" > "$filename"
   }
   ```

## 📝 移行の容易さ

1. **既存ユーザー**
   - コマンド名は同じ
   - 基本的な使い方は変わらない
   - より直感的に

2. **新規ユーザー**
   - worktree概念の学習不要
   - 役割ベースで理解しやすい
   - エラーからの回復が容易

## 🎯 次のステップ

このコンセプトで進める場合：

1. **Phase 1**: プロトタイプ実装
   - multi-feature.md の書き換え
   - 基本的な役割切り替え実装

2. **Phase 2**: 他コマンドへの展開
   - multi-tdd.md の役割進化版
   - multi-refactor.md の役割進化版

3. **Phase 3**: ccmanager統合（軽量）
   - 進捗表示のみ
   - プリセット管理は不要

---
生成日時: 2025-01-11 12:30:00