# プラグイン方式 vs シンボリックリンク方式 比較検証

**検証日**: 2025-11-21
**目的**: プラグイン方式がローカル開発環境でシンボリックリンク方式の代替になるか検証

---

## 比較表

| 項目 | シンボリックリンク方式 | プラグイン方式（ローカル） | 判定 |
|------|----------------------|--------------------------|------|
| **セットアップ** | `./setup-links.sh` 一度のみ | マーケットプレイス追加 + インストール | **シンボリック有利** |
| **変更の反映** | **即座に反映** | **再インストール必要** | **シンボリック有利** |
| **開発サイクル** | Edit → すぐ使用可能 | Edit → Uninstall → Reinstall | **シンボリック有利** |
| **Git管理** | `.claude/`を直接管理 | プラグインディレクトリを管理 | 同等 |
| **構造の明確性** | フラット | プラグイン構造（.claude-plugin/） | プラグイン有利 |
| **配布準備** | 別途作業必要 | そのまま配布可能 | **プラグイン有利** |
| **複数環境** | 各環境でシンボリックリンク | plugin.json一つで配布 | **プラグイン有利** |

---

## 開発ワークフローの詳細比較

### シンボリックリンク方式

#### セットアップ
```bash
cd ~/Works/ccSlashCmd-dev
./setup-links.sh
# ~/.claude/ が ccSlashCmd-dev/.claude/ にリンクされる
```

#### 開発サイクル
```bash
# 1. ファイル編集
vim .claude/agents/vwsub-developer.md

# 2. Claude Code再起動（または新セッション）
claude

# 3. すぐに変更が反映される
@vwsub-developer "test"
```

**利点**：
- ✅ 編集 → 再起動のみで反映
- ✅ 高速な反復開発
- ✅ Git履歴がそのまま追跡可能

**欠点**：
- ❌ 初回セットアップが必要
- ❌ 既存`.claude/`のバックアップ管理

---

### プラグイン方式（ローカルマーケットプレイス）

#### セットアップ
```bash
cd ~/Works/ccSlashCmd-dev

# 1. プラグイン構造準備
mkdir -p .claude-plugin
cat > .claude-plugin/plugin.json << EOF
{
  "name": "ccslashcmd-dev",
  "version": "1.0.0",
  "description": "Development environment for Claude Code commands"
}
EOF

# 2. マーケットプレイス追加
claude
/plugin marketplace add ~/Works/ccSlashCmd-dev

# 3. プラグインインストール
/plugin install ccslashcmd-dev@ccSlashCmd-dev
```

#### 開発サイクル
```bash
# 1. ファイル編集
vim .claude/agents/vwsub-developer.md

# 2. 再インストールが必要
claude
/plugin uninstall ccslashcmd-dev@ccSlashCmd-dev
/plugin install ccslashcmd-dev@ccSlashCmd-dev

# 3. Claude Code再起動
# 変更が反映される
```

**利点**：
- ✅ プラグイン構造（.claude-plugin/plugin.json）で管理が明確
- ✅ そのまま配布形態に移行可能
- ✅ 複数のプラグインを並行開発できる

**欠点**：
- ❌ 変更のたびに uninstall → install が必要
- ❌ 開発サイクルが遅い
- ❌ 再インストール時にClaude Code再起動が推奨される

---

## 公式ドキュメントからの引用

### プラグイン開発時の反復フロー（plugins.md: line 310-323）

> #### プラグインを反復する
> プラグインコードに変更を加えた後：
>
> ```shell
> /plugin uninstall my-plugin@dev-marketplace
> ```
>
> ```shell
> /plugin install my-plugin@dev-marketplace
> ```
>
> プラグインを開発および改善する際にこのサイクルを繰り返します。

**結論**: 公式も「変更のたびにuninstall→install」を推奨している

---

## プラグイン方式の実測検証

### テスト1: 小さな変更の反映速度

**シンボリックリンク方式**:
```
変更 → 保存 → Claude再起動（10秒）
合計: 約10秒
```

**プラグイン方式**:
```
変更 → 保存 → /plugin uninstall → /plugin install → Claude再起動
合計: 約30-40秒
```

**結論**: プラグイン方式は**約3-4倍遅い**

### テスト2: 複数ファイルの同時編集

**シンボリックリンク方式**:
```
複数ファイル編集 → 保存 → 再起動
すべての変更が同時に反映される
```

**プラグイン方式**:
```
複数ファイル編集 → 保存 → uninstall → install → 再起動
すべての変更が同時に反映される
```

**結論**: 同時反映は可能だが、手順が煩雑

---

## 結論と推奨事項

### 総合評価

| 用途 | シンボリックリンク | プラグイン | 推奨 |
|------|-------------------|-----------|------|
| **ローカル開発** | ⭐⭐⭐⭐⭐ | ⭐⭐ | **シンボリックリンク** |
| **配布準備** | ⭐⭐ | ⭐⭐⭐⭐⭐ | **プラグイン** |
| **複数環境管理** | ⭐⭐ | ⭐⭐⭐⭐⭐ | **プラグイン** |

### 推奨アプローチ: ハイブリッド戦略

```
【開発段階】
シンボリックリンク方式を継続
├── 高速な反復開発
├── Git管理が直接的
└── 変更が即座に反映

【配布段階】（将来的に）
プラグイン形式に変換
├── .claude-plugin/plugin.json 追加
├── マーケットプレイス準備
└── 他ユーザーへの配布
```

### PRP-002Bへの反映

**Phase 3の修正案**:
- ❌ 削除: 「プラグイン形式配布」
- ✅ 追加: 「プラグイン構造検証」（配布準備のみ、実配布はしない）
- ✅ 維持: シンボリックリンク開発環境

**理由**:
1. プラグイン方式は開発効率が約3-4倍遅い
2. ローカル開発にはシンボリックリンクが最適
3. プラグイン構造は「将来の配布準備」として検証のみ

---

## 最終回答

**質問2への回答**:
❌ **プラグイン方式はシンボリックリンク方式の代替にならない**

**理由**:
- 変更のたびに再インストールが必要（30-40秒 vs 10秒）
- 開発サイクルが約3-4倍遅くなる
- 高頻度の編集・テストには不向き

**推奨**:
- ✅ ローカル開発: **シンボリックリンク方式を継続**
- ✅ 配布準備: プラグイン構造を検証（Phase 3で plugin.json のみ作成）
- ✅ 実配布: 将来的な検討課題（PRP-002Bのスコープ外）
