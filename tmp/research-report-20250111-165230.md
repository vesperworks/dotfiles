# multi-feature-ccm.md で ccmanager により削減可能な機能の分析

## 📋 要約
multi-feature-ccm.mdには多くのccmanager重複機能があり、大幅に簡素化できます。worktree管理、セッション制御、状態管理の部分はccmanagerに委譲し、ワークフロー制御に集中すべきです。

## 🔍 詳細分析

### 現状
multi-feature-ccm.mdは582行の長大なコマンドで、以下の機能を含んでいます：
1. worktree作成・管理（約100行）
2. ccmanagerセッション登録・状態管理（約150行）
3. 5フェーズワークフロー制御（約250行）
4. レポート生成・git操作（約80行）

### ccmanagerで代替可能な機能

#### 1. Worktree管理全般（行73-162）
```bash
# 現在の実装
WORKTREE_INFO=$(create_task_worktree "$TASK_DESCRIPTION" "feature")
WORKTREE_PATH=$(echo "$WORKTREE_INFO" | cut -d'|' -f1)
# ... 複雑なworktree作成ロジック
```
→ **ccmanagerの`⊕ New Worktree`機能で代替可能**

#### 2. ccmanager設定ファイル作成（行98-132）
```json
{
  "featureName": "$FEATURE_NAME",
  "branch": "$FEATURE_BRANCH",
  "phases": { ... },
  "currentPhase": "explorer",
  "startTime": "..."
}
```
→ **ccmanagerが自動管理するため不要**

#### 3. フェーズ状態更新関数（行193-200）
```bash
update_ccm_phase() {
    local phase="$1"
    local status="$2"
    cd "$WORKTREE_PATH"
    jq ".phases.${phase}.status = \"${status}\"" ...
}
```
→ **ccmanagerのステータス管理で自動化**

#### 4. セッション起動・切り替え（行211-217, 258-264）
```bash
if [[ "${AUTO_START_CCM:-false}" == "true" ]]; then
    ccmanager start --preset "${PRESET_BASE}-explorer"
fi
```
→ **ccmanagerのプリセット切り替えUIで手動実行**

#### 5. ccmanager統計収集（行407-421）
```bash
jq -r '
    "- Feature: \(.featureName)",
    "- Phases Completed: \(.phases | ...)",
    ...'
```
→ **ccmanagerの内部統計機能で代替**

### 提案する解決策

#### 削減可能な部分（約300行削減可能）

1. **worktree作成部分を簡素化**
   - ccmanagerのworktree作成に委譲
   - 環境変数設定のみ残す

2. **ccmanager設定ファイル作成を削除**
   - .ccmanager/feature-config.json作成は不要
   - ccmanagerの内部管理に任せる

3. **フェーズ状態管理を削除**
   - update_ccm_phase関数を削除
   - ccmanagerのUI表示に任せる

4. **セッション自動起動を削除**
   - AUTO_START_CCM関連のコードを削除
   - ユーザーがccmanager UIで操作

5. **統計レポート部分を簡素化**
   - ccmanager固有の統計収集を削除
   - 基本的なgit情報のみ残す

## 📊 影響評価
- 作業量: 中
- リスク: 低（既存機能は保持）
- 優先度: 中
- コード削減: 約300行（50%削減）

## 🎯 推奨アクション

### 簡素化後の構造案

```markdown
# Multi-Agent Feature Development (Simplified)

1. **初期化フェーズ**（30行）
   - 基本的な環境変数設定
   - ccmanagerでworktree作成を促す

2. **ワークフローフェーズ**（200行）
   - Explorer/Planner/Prototype/Coder/Completionの制御
   - 各フェーズのプロンプト表示
   - 結果ファイルの保存

3. **完了フェーズ**（50行）
   - テスト実行
   - レポート生成
   - マージ/PR作成

合計: 約280行（現在の582行から302行削減）
```

### 主要な変更点

1. **ccmanager前提の動作に変更**
   - --no-ccmオプションを削除
   - ccmanagerがない場合はエラー終了

2. **手動操作を前提に**
   - worktree作成はccmanager UIで
   - セッション切り替えもccmanager UIで

3. **ワークフロー制御に集中**
   - 5フェーズの進行管理
   - 品質ゲートとレポート生成

---
次のアクションを選択してください：
1️⃣ `/p add-todo` - todo.mdに追加
2️⃣ `/p execute` - すぐに実行