---
name: sow
description: 問題修正のための作業仕様書（SOW）をdiff付きで作成
usage: /sow ["問題の説明"]
---

# SOW - 作業仕様書作成コマンド

## 概要
このコマンドは、修正が必要な問題に対して作業仕様書（SOW: Statement of Work）を作成します。
SOWには問題の詳細、修正方針、具体的なdiff（変更内容）を含め、`./tmp`ディレクトリに保存します。

## 処理フロー

1. **問題分析**
   - 現在のコードベースの状態を確認
   - 問題の詳細を調査・分析
   - 影響範囲の特定

2. **修正方針策定**
   - 問題の根本原因を特定
   - 修正アプローチの決定
   - 実装に必要な手順の整理

3. **Diff生成**
   - 具体的な修正内容のdiff作成
   - 変更前後の比較を明確化
   - テストケースの追加・修正案

4. **SOW文書作成**
   - 上記内容を整理した作業仕様書を作成
   - `./tmp/sow-{timestamp}.md`として保存
   - 実装者が理解しやすい形式で記述

## 実行手順

```bash
# tmpディレクトリの確認・作成
mkdir -p ./tmp

# 問題の調査
echo "🔍 問題を調査中..."
# - エラーログの確認
# - 関連ファイルの特定
# - 現在の実装状態の把握

# SOW文書の生成
echo "📝 作業仕様書を作成中..."
# - 問題の詳細説明
# - 修正方針
# - 具体的なdiff
# - テスト方針
# - 実装手順

# 結果の保存
SOW_FILE="./tmp/sow-$(date +%Y%m%d-%H%M%S).md"
echo "💾 SOWを保存しました: $SOW_FILE"

# ユーザーへの報告
echo "✅ 作業仕様書の作成が完了しました"
echo "📄 ファイル: $SOW_FILE"
```

## SOWテンプレート構造

```markdown
# 作業仕様書 (SOW)

## 1. 問題の概要
- **問題ID**: [自動生成されるID]
- **作成日時**: [作成日時]
- **問題の説明**: [問題の詳細な説明]
- **影響範囲**: [影響を受けるファイル・機能]

## 2. 現状分析
- **根本原因**: [問題の原因]
- **現在の実装**: [現状のコード説明]
- **制約事項**: [考慮すべき制約]

## 3. 修正方針
- **アプローチ**: [修正のアプローチ]
- **変更予定ファイル**: [変更するファイルのリスト]
- **リスク**: [潜在的なリスク]

## 4. 具体的な変更内容

### ファイル: [ファイルパス]
\`\`\`diff
[具体的なdiff内容]
\`\`\`

### ファイル: [ファイルパス]
\`\`\`diff
[具体的なdiff内容]
\`\`\`

## 5. テスト計画
- **テストケース**: [追加・修正するテスト]
- **検証項目**: [確認すべき項目]

## 6. 実装手順
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

## 7. 完了条件
- [ ] すべての変更が適用されている
- [ ] テストがパスしている
- [ ] リグレッションが発生していない
```

## 使用例

```bash
# 基本的な使用方法
/sow

# 特定の問題に対してSOWを作成
/sow "認証エラーの修正"

# 複数ファイルの修正が必要な場合
/sow "TypeScriptマイグレーション"
```

## 注意事項

1. **自動分析**: コマンド実行時に現在のコードベースを自動的に分析します
2. **差分の明確化**: 変更前後の違いを明確にdiff形式で提示します
3. **実装可能性**: 実際に実装可能な具体的な修正案を提供します
4. **トレーサビリティ**: タイムスタンプ付きでSOWを保存し、履歴を追跡可能にします

## 期待される出力

```
🔍 問題を調査中...
  ✓ エラーログを確認しました
  ✓ 関連ファイルを特定しました
  ✓ 現在の実装を分析しました

📝 作業仕様書を作成中...
  ✓ 問題の詳細を文書化しました
  ✓ 修正方針を策定しました
  ✓ 具体的なdiffを生成しました
  ✓ テスト方針を追加しました

💾 SOWを保存しました: ./tmp/sow-20250111-123456.md

✅ 作業仕様書の作成が完了しました
📄 ファイル: ./tmp/sow-20250111-123456.md

作業仕様書の内容を確認して、実装を開始してください。
```