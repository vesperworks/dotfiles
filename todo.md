# TODO: マルチエージェントワークフロー実装の残タスク

更新日: 2025-06-25（全multiコマンドのセッション分離問題修正完了）

## 🟠 高優先度タスク

### 全multiコマンドの統合テスト
- [ ] 各コマンドで実際のタスクを実行
- [ ] エラーハンドリングの動作確認
- [ ] 並行実行時の動作検証

### 環境ファイル管理の改善
- [ ] **環境ファイル検索方法の改善**
  - 現在: `ls -t`で最新ファイルを取得（並行実行時に問題の可能性）
  - 改善: Step 1で生成したENV_FILEパスを各フェーズに明示的に渡す
- [ ] **セキュリティ対策**
  - `.gitignore`に`.worktrees/.env-*`を追加
- [ ] **エラーハンドリングの詳細化**
  - 環境ファイル未検出時のエラーメッセージを改善

### 修正フェーズ3: 検証とテスト
- [ ] **テスト1**: 日本語パラメータでのworktree作成テスト
- [ ] **テスト2**: 各フェーズの順次実行テスト（Analysis→Plan→Refactor→Verify）
- [ ] **テスト3**: エラー発生時の適切な処理テスト（rollback動作確認）
- [ ] **テスト4**: 最終的なリファクタリング完了テスト（実際のコード整理）

### 並列TDD機能のコマンド統合
- [ ] multi-tdd.mdに`--parallel`オプションを追加
- [ ] オプション指定時に`run_parallel_agents()`を呼び出す
- [ ] デフォルトは従来の順次実行を維持
- [ ] 使用例とパフォーマンス比較をドキュメント化

## 🟡 中優先度タスク

### 各ワークフローの自動テストスクリプト作成
- [ ] 各ワークフローの自動テストスクリプト作成

### ドキュメント整備
- [ ] トラブルシューティングガイド
- [ ] ベストプラクティス集
- [ ] CLAUDE.mdのプロジェクト構造更新

## 🟢 低優先度タスク（将来実装）

### MCP連携機能の実装
- [ ] Context7連携の具体的な実装
- [ ] Playwright/Puppeteer統合のサンプル作成
- [ ] MCP設定ドキュメントの作成

### TDDサイクルの並列化による効率化
- [ ] Testerエージェントの早期投入
- [ ] MCP連携の専門化
- [ ] 効果測定（運用後実施予定）

### エラーハンドリング強化
- [ ] worktree作成失敗時のリトライ機能
- [ ] ネットワークエラー時の対処
- [ ] 不完全なタスクのリカバリー機能

### 監視・ログ機能
- [ ] タスク実行履歴の記録
- [ ] パフォーマンスメトリクスの収集
- [ ] 成功/失敗率の可視化

### 設定のカスタマイズ
- [ ] `.claude/config.json` - ユーザー設定ファイル
- [ ] タイムアウト値の調整機能
- [ ] デフォルトブランチ名のカスタマイズ

## 💡 次のアクション（2025-06-25時点）

1. **✅ 完了**: 全multiコマンドのセッション分離問題修正
   - multi-tdd.md、multi-feature.md、multi-refactor.mdの修正完了
   - 環境変数の保存・復元処理を統一実装済み
   
2. **🔴 即座に実施**: 環境ファイル管理の改善
   - 環境ファイル検索方法の改善（並行実行対応）
   - セキュリティ対策（.gitignoreへの追加）
   - エラーハンドリングの詳細化
   
3. **🟠 その後実施**: 全multiコマンドの統合テスト
   - 各コマンドで実際のタスクを実行
   - エラーハンドリングの動作確認
   - 並行実行時の動作検証
   
4. **🟡 続いて実施**: multi-feature.mdの品質改善
   - XMLタグ構造とフェーズ管理システムの導入
   - Anthropicベストプラクティスの適用

## 🌟 multi-feature.md改善項目（Anthropicプロンプト分析から）

### 高優先度改善
- [ ] **XMLタグ構造の導入**
  - [ ] `<feature_development_workflow>`でワークフロー全体を囲む
  - [ ] 各フェーズを`<phase name="explore">`等でマークアップ
  - [ ] `<objectives>`, `<tools>`, `<output>`で各フェーズ内容を構造化
  - [ ] `<quality_gates>`で品質基準を明確化

- [ ] **強調語の体系的使用**
  - [ ] `ALWAYS`: 必須のコミット、テスト実行に使用
  - [ ] `NEVER`: 未テストのコミット、main直接編集の禁止に使用
  - [ ] `MUST`: ファイル作成前の確認、品質ゲート通過に使用
  - [ ] `IMPORTANT`: 重要な注意事項に限定使用

### 中優先度改善
- [ ] **番号付きリストによる段階的指示**
  - [ ] 各フェーズ内のステップを番号付きリストに変更
  - [ ] サブステップは箇条書きで整理
  - [ ] ステップ名をボールド体で強調

- [ ] **具体例の追加**
  - [ ] 各ワークフローに実行例を3つ以上追加
  - [ ] feature開発の具体例（認証、決済、通知など）
  - [ ] 期待される成果物の例を明示

- [ ] **数値制限の明示**
  - [ ] 最大ファイル数/フェーズ: 10
  - [ ] 最大コミット数/フェーズ: 5
  - [ ] タイムアウト/フェーズ: 15分
  - [ ] 最小テストカバレッジ: 80%

### 低優先度改善
- [ ] **簡潔性の向上**
  - [ ] 冗長な説明を削除
  - [ ] コマンド例をコードブロックで簡潔に
  - [ ] 「情報密度を高く、言葉数は最小に」の原則適用

- [ ] **条件分岐の明示的処理**
  - [ ] 「For depth-first features:」形式で条件別対応を記載
  - [ ] 「For breadth-first features:」で並列開発可能な機能を区別
  - [ ] 「For straightforward features:」で単純な機能開発を効率化

- [ ] **エラーハンドリングとフォールバック**
  - [ ] 各フェーズのエラー時の具体的対処法
  - [ ] 競合解決のための手順
  - [ ] ロールバック手順の明確化

### 実装順序
1. **第1段階**: XMLタグ構造と強調語の導入（構造的改善）
2. **第2段階**: 番号付きリストと具体例の追加（理解促進）
3. **第3段階**: 数値制限と品質ゲートの明示（品質保証）
4. **第4段階**: 簡潔性向上と条件分岐処理（最適化）